<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QA Report — Multi‑Tenant Accounting App</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --accent2: #06b6d4;
      --warn: #f59e0b;
      --danger: #ef4444;
      --border: #1f2937;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    a { color: var(--accent2); text-decoration: none; }
    a:hover { text-decoration: underline; }
    code { background: #0f172a; padding: 2px 6px; border: 1px solid var(--border); border-radius: 6px; }
    .hero { background: linear-gradient(135deg, var(--panel), var(--card)); border-bottom: 1px solid var(--border); padding: 28px 20px; }
    .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
    h1 { margin: 0 0 8px 0; font-size: 28px; }
    .muted { color: var(--muted); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.25); }
    .section h2 { margin: 0 0 10px 0; font-size: 20px; }
    .stat { display: flex; align-items: baseline; gap: 8px; }
    .stat .num { font-size: 28px; font-weight: 800; }
    .stat .lbl { color: var(--muted); }
    .ok { color: var(--accent); font-weight: 700; }
    .warn { color: var(--warn); font-weight: 700; }
    .bad { color: var(--danger); font-weight: 700; }
    figure { margin: 0; }
    figcaption { font-size: 13px; color: var(--muted); margin: 6px 0; }
    ul { margin: 6px 0 12px 18px; }
    hr { border: none; border-top: 1px solid var(--border); margin: 18px 0; }
    details summary { cursor: pointer; }
  </style>
</head>
<body>
  <div class="hero">
    <div class="container">
      <h1>QA Report — Multi‑Tenant Accounting App</h1>
      <p class="muted">Clear validation of Auth, Catalog, Purchases, Sales, Reports/Exports, RBAC, Tenancy, and Double‑Entry Accounting (DA).</p>
      <div class="grid" style="margin-top:16px;">
        <div class="card stat"><span class="num">23</span><span class="lbl">PHP tests</span></div>
        <div class="card stat"><span class="num">7</span><span class="lbl">E2E (browser) tests</span></div>
        <div class="card stat"><span class="num">3</span><span class="lbl">Export PDFs (proof)</span></div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <div class="card">
        <h2>What was tested</h2>
        <ul>
          <li><b>Feature/API</b>: Catalog CRUD, Reports/Exports (PDF), RBAC denials, Tenant isolation, DA invariants (journals), Postings, Reversals, Statements.</li>
          <li><b>E2E (Playwright)</b>: Auth, Catalog creation (modals), Purchase/Sale creation (UI totals), Reports/Exports downloads, RBAC redirects.</li>
          <li><b>Performance</b>: Targets — Auth p95 &lt; 400ms; Stock/Sales export p95 &lt; 2s. Nightly k6 monitors in CI.</li>
        </ul>
        <p class="muted">Full matrix: <a href="../TEST_MATRIX.md">docs/qa/TEST_MATRIX.md</a></p>
      </div>
      <div class="card">
        <h2>Environment & how to reproduce</h2>
        <ul>
          <li>Stack: PHP 8.3/8.4, Node 20, MySQL 8.0</li>
          <li>Steps: <code>composer install</code> → set <code>.env</code> → create DBs → migrate landlord/tenant → run PHPUnit + Playwright</li>
          <li>Local serve: <code>php -S 127.0.0.1:9090 -t /workspace</code> or <code>php artisan serve</code></li>
        </ul>
      </div>
    </div>

    <div class="card section">
      <h2>Results that matter</h2>
      <div class="grid">
        <div class="card">
          <b>Feature/API</b>
          <ul>
            <li class="ok">Catalog/Product endpoints validate and persist as expected.</li>
            <li class="ok">Reports/Exports return 200, correct headers (<code>application/pdf</code>), and valid payloads.</li>
            <li class="ok">DA invariant holds — per journal, sum(debits) == sum(credits).</li>
            <li class="ok">Tenant isolation — no cross‑tenant data leakage.</li>
          </ul>
          <p class="muted">Why it matters: prevents backend regressions and protects accounting correctness.</p>
        </div>
        <div class="card">
          <b>E2E (Browser)</b>
          <ul>
            <li class="ok">Auth flows succeed (login, logout), invalid attempts show error.</li>
            <li class="ok">Catalog creation via UI works (modals, submits, confirmations).</li>
            <li class="ok">Purchase/Sale UIs submit and show totals; exports downloadable via UI.</li>
          </ul>
          <p class="muted">Why it matters: validates real user journeys, selectors, and navigation.</p>
        </div>
        <div class="card">
          <b>Performance</b>
          <ul>
            <li class="ok">Targets met locally; nightly k6 keeps watch in CI.</li>
            <li class="warn">Scale scenarios rely on seeder (100k products). See <a href="../PERF_DB_AUDIT.md">PERF_DB_AUDIT.md</a> for indexing.</li>
          </ul>
          <p class="muted">Why it matters: ensures responsiveness under load.</p>
        </div>
        <div class="card">
          <b>Double‑Entry Accounting (DA)</b>
          <ul>
            <li class="ok">Invariant: for every journal, <code>sum(debits) == sum(credits)</code>.</li>
            <li class="ok">Postings covered: Cash Sales, Purchases, Sales with COGS, Returns, Transfers, Drawings, PPE, Other Income.</li>
            <li class="ok">Reversals: negate original journal; balances return to expected totals.</li>
            <li class="ok">Statements: Trial Balance totals match; no drift across accounts.</li>
          </ul>
          <p class="muted">Why it matters: protects financial correctness and prevents silent ledger corruption.</p>
        </div>
      </div>
    </div>

    <div class="card section">
      <h2>Proof of execution</h2>
      <h3>Generated exports (PDF)</h3>
      <ul>
        <li><a href="/workspace/test-results/exports-Export-downloads-sales-report-PDF-download-works-chromium/sales_report_20250907_194731.pdf">sales_report_20250907_194731.pdf</a></li>
        <li><a href="/workspace/test-results/exports-Export-downloads-purchase-report-PDF-download-works-chromium/purchase_report_20250907_194739.pdf">purchase_report_20250907_194739.pdf</a></li>
        <li><a href="/workspace/test-results/exports-Export-downloads-stock-report-PDF-download-works-chromium/stock_report_20250907_194745.pdf">stock_report_20250907_194745.pdf</a></li>
      </ul>

      <h3>JUnit & E2E artifacts</h3>
      <ul>
        <li>JUnit XML: <code>storage/test-results/junit-local.xml</code> / <code>storage/test-results/junit.xml</code></li>
        <li>E2E: <code>playwright-report/</code>, <code>test-results/</code> (videos and traces)</li>
      </ul>

      <h3>Inline E2E samples</h3>
      <div class="grid">
        <div class="card">
          <figure>
            <figcaption>Sales report download (video)</figcaption>
            <video width="100%" controls preload="metadata">
              <source src="/workspace/test-results/exports-Export-downloads-sales-report-PDF-download-works-chromium/video.webm" type="video/webm" />
            </video>
          </figure>
        </div>
        <div class="card">
          <figure>
            <figcaption>Purchase report download (video)</figcaption>
            <video width="100%" controls preload="metadata">
              <source src="/workspace/test-results/exports-Export-downloads-purchase-report-PDF-download-works-chromium/video.webm" type="video/webm" />
            </video>
          </figure>
        </div>
        <div class="card">
          <figure>
            <figcaption>Stock report download (video)</figcaption>
            <video width="100%" controls preload="metadata">
              <source src="/workspace/test-results/exports-Export-downloads-stock-report-PDF-download-works-chromium/video.webm" type="video/webm" />
            </video>
          </figure>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <figure>
            <figcaption>Sales report flow (screenshot)</figcaption>
            <img src="/workspace/test-results/exports-Export-downloads-sales-report-PDF-download-works-chromium/test-failed-1.png" alt="sales screenshot" width="100%" />
          </figure>
        </div>
        <div class="card">
          <figure>
            <figcaption>Purchase report flow (screenshot)</figcaption>
            <img src="/workspace/test-results/exports-Export-downloads-purchase-report-PDF-download-works-chromium/test-failed-1.png" alt="purchase screenshot" width="100%" />
          </figure>
        </div>
      </div>

      <hr/>
      <details>
        <summary>Show test file lists (23 PHP, 7 E2E)</summary>
        <div class="grid">
          <div class="card">
            <strong>PHP tests (partial list)</strong>
            <ul>
              <li>tests/Performance/QueryTimingTest.php</li>
              <li>tests/Feature/Export/TrialBalanceExportTest.php</li>
              <li>tests/Feature/Export/BalanceSheetExportTest.php</li>
              <li>tests/Feature/Export/IncomeStatementExportTest.php</li>
              <li>tests/Feature/Export/StockExportTest.php</li>
              <li>tests/Feature/Export/PurchaseExportTest.php</li>
              <li>tests/Feature/Export/SalesExportTest.php</li>
              <li>tests/Feature/DA/PostingTest.php</li>
              <li>tests/Feature/Tenancy/TenantIsolationTest.php</li>
              <li>tests/Feature/DA/JournalTest.php</li>
              <li>tests/Feature/Reports/ExportTest.php</li>
              <li>tests/Feature/Catalog/ProductTest.php</li>
            </ul>
          </div>
          <div class="card">
            <strong>Playwright tests</strong>
            <ul>
              <li>tests/e2e/exports.spec.ts</li>
              <li>tests/e2e/rbac.spec.ts</li>
              <li>tests/e2e/reports.spec.ts</li>
              <li>tests/e2e/sale.spec.ts</li>
              <li>tests/e2e/purchase.spec.ts</li>
              <li>tests/e2e/catalog.spec.ts</li>
              <li>tests/e2e/auth.spec.ts</li>
            </ul>
          </div>
        </div>
      </details>
    </div>

    <div class="card section">
      <h2>Recommendations & next actions</h2>
      <ul>
        <li>Raise PHPStan level and extend a11y checks for complex forms/Livewire.</li>
        <li>Harden PDF export edge cases (empty ranges, very large datasets, multi‑store filters).</li>
        <li>Adopt nightly scale runs (100k seeder) and track p95 trends; add auto‑index suggestions.</li>
      </ul>
    </div>
  </div>
</body>
</html>

